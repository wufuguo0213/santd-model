'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.loadConfig = loadConfig;

var _manis = require('manis');

var _manis2 = _interopRequireDefault(_manis);

var _path = require('path');

var _jsYaml = require('js-yaml');

var _jsYaml2 = _interopRequireDefault(_jsYaml);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

'use strict'; /**
               * @file 对配置文件的读取合并等等
               * @author ielgnaw(wuji0223@gmail.com)
               */

var STORAGE = null;

// const JSON_YAML_REG = /.+\.(json|yml)$/i;

/**
 * 获取 merge 后的配置文件
 *
 * @param {string} filePath 待检查的文件路径，根据这个路径去寻找用户自定义的配置文件，然后和默认的配置文件 merge
 * @param {boolean} refresh 是否强制刷新内存中已经存在的配置
 *
 * @return {Object} merge 后的配置对象
 */
function loadConfig(filePath, refresh) {
    if (!refresh && STORAGE) {
        return STORAGE;
    }

    var manis = new _manis2.default({
        files: ['.csshintrc'],
        loader: function loader(content) {
            if (!content) {
                return '';
            }
            var ret = void 0;
            try {
                ret = _jsYaml2.default.load(content);
            } catch (e) {}
            // if (basename(filePath) === '.csshintrc') {
            //     return JSON.parse(stripJSONComments(content));
            // }
            //
            // let match = filePath.match(JSON_YAML_REG);
            //
            // if (match) {
            //     let suffix = match[1];
            //     if (suffix === 'json') {
            //         return JSON.parse(stripJSONComments(content));
            //     }
            //     else if (suffix === 'yml') {
            //         return yaml.load(content);
            //     }
            // }
            return ret;
        }
    });

    manis.setDefault((0, _path.join)(__dirname, './csshint.yml'));

    STORAGE = manis.from(filePath);

    return STORAGE;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25maWcuanMiXSwibmFtZXMiOlsibG9hZENvbmZpZyIsIlNUT1JBR0UiLCJmaWxlUGF0aCIsInJlZnJlc2giLCJtYW5pcyIsIk1hbmlzIiwiZmlsZXMiLCJsb2FkZXIiLCJjb250ZW50IiwicmV0IiwieWFtbCIsImxvYWQiLCJlIiwic2V0RGVmYXVsdCIsIl9fZGlybmFtZSIsImZyb20iXSwibWFwcGluZ3MiOiI7Ozs7O1FBdUJnQkEsVSxHQUFBQSxVOztBQWxCaEI7Ozs7QUFDQTs7QUFDQTs7Ozs7O0FBRUEsYSxDQVRBOzs7OztBQVdBLElBQUlDLFVBQVUsSUFBZDs7QUFFQTs7QUFFQTs7Ozs7Ozs7QUFRTyxTQUFTRCxVQUFULENBQW9CRSxRQUFwQixFQUE4QkMsT0FBOUIsRUFBdUM7QUFDMUMsUUFBSSxDQUFDQSxPQUFELElBQVlGLE9BQWhCLEVBQXlCO0FBQ3JCLGVBQU9BLE9BQVA7QUFDSDs7QUFFRCxRQUFJRyxRQUFRLElBQUlDLGVBQUosQ0FBVTtBQUNsQkMsZUFBTyxDQUNILFlBREcsQ0FEVztBQUlsQkMsY0FKa0Isa0JBSVhDLE9BSlcsRUFJRjtBQUNaLGdCQUFJLENBQUNBLE9BQUwsRUFBYztBQUNWLHVCQUFPLEVBQVA7QUFDSDtBQUNELGdCQUFJQyxZQUFKO0FBQ0EsZ0JBQUk7QUFDQUEsc0JBQU1DLGlCQUFLQyxJQUFMLENBQVVILE9BQVYsQ0FBTjtBQUNILGFBRkQsQ0FHQSxPQUFPSSxDQUFQLEVBQVUsQ0FBRTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFPSCxHQUFQO0FBQ0g7QUE3QmlCLEtBQVYsQ0FBWjs7QUFnQ0FMLFVBQU1TLFVBQU4sQ0FBaUIsZ0JBQUtDLFNBQUwsRUFBZ0IsZUFBaEIsQ0FBakI7O0FBRUFiLGNBQVVHLE1BQU1XLElBQU4sQ0FBV2IsUUFBWCxDQUFWOztBQUVBLFdBQU9ELE9BQVA7QUFDSCIsImZpbGUiOiJjb25maWcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIOWvuemFjee9ruaWh+S7tueahOivu+WPluWQiOW5tuetieetiVxuICogQGF1dGhvciBpZWxnbmF3KHd1amkwMjIzQGdtYWlsLmNvbSlcbiAqL1xuXG5pbXBvcnQgTWFuaXMgZnJvbSAnbWFuaXMnO1xuaW1wb3J0IHtqb2lufSBmcm9tICdwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ2pzLXlhbWwnO1xuXG4ndXNlIHN0cmljdCc7XG5cbmxldCBTVE9SQUdFID0gbnVsbDtcblxuLy8gY29uc3QgSlNPTl9ZQU1MX1JFRyA9IC8uK1xcLihqc29ufHltbCkkL2k7XG5cbi8qKlxuICog6I635Y+WIG1lcmdlIOWQjueahOmFjee9ruaWh+S7tlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlUGF0aCDlvoXmo4Dmn6XnmoTmlofku7bot6/lvoTvvIzmoLnmja7ov5nkuKrot6/lvoTljrvlr7vmib7nlKjmiLfoh6rlrprkuYnnmoTphY3nva7mlofku7bvvIznhLblkI7lkozpu5jorqTnmoTphY3nva7mlofku7YgbWVyZ2VcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gcmVmcmVzaCDmmK/lkKblvLrliLbliLfmlrDlhoXlrZjkuK3lt7Lnu4/lrZjlnKjnmoTphY3nva5cbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IG1lcmdlIOWQjueahOmFjee9ruWvueixoVxuICovXG5leHBvcnQgZnVuY3Rpb24gbG9hZENvbmZpZyhmaWxlUGF0aCwgcmVmcmVzaCkge1xuICAgIGlmICghcmVmcmVzaCAmJiBTVE9SQUdFKSB7XG4gICAgICAgIHJldHVybiBTVE9SQUdFO1xuICAgIH1cblxuICAgIGxldCBtYW5pcyA9IG5ldyBNYW5pcyh7XG4gICAgICAgIGZpbGVzOiBbXG4gICAgICAgICAgICAnLmNzc2hpbnRyYydcbiAgICAgICAgXSxcbiAgICAgICAgbG9hZGVyKGNvbnRlbnQpIHtcbiAgICAgICAgICAgIGlmICghY29udGVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCByZXQ7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJldCA9IHlhbWwubG9hZChjb250ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7fVxuICAgICAgICAgICAgLy8gaWYgKGJhc2VuYW1lKGZpbGVQYXRoKSA9PT0gJy5jc3NoaW50cmMnKSB7XG4gICAgICAgICAgICAvLyAgICAgcmV0dXJuIEpTT04ucGFyc2Uoc3RyaXBKU09OQ29tbWVudHMoY29udGVudCkpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIGxldCBtYXRjaCA9IGZpbGVQYXRoLm1hdGNoKEpTT05fWUFNTF9SRUcpO1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgLy8gICAgIGxldCBzdWZmaXggPSBtYXRjaFsxXTtcbiAgICAgICAgICAgIC8vICAgICBpZiAoc3VmZml4ID09PSAnanNvbicpIHtcbiAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uoc3RyaXBKU09OQ29tbWVudHMoY29udGVudCkpO1xuICAgICAgICAgICAgLy8gICAgIH1cbiAgICAgICAgICAgIC8vICAgICBlbHNlIGlmIChzdWZmaXggPT09ICd5bWwnKSB7XG4gICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiB5YW1sLmxvYWQoY29udGVudCk7XG4gICAgICAgICAgICAvLyAgICAgfVxuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgbWFuaXMuc2V0RGVmYXVsdChqb2luKF9fZGlybmFtZSwgJy4vY3NzaGludC55bWwnKSk7XG5cbiAgICBTVE9SQUdFID0gbWFuaXMuZnJvbShmaWxlUGF0aCk7XG5cbiAgICByZXR1cm4gU1RPUkFHRTtcbn1cbiJdfQ==