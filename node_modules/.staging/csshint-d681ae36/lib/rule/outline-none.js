'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.check = undefined;

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _util = require('../util');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 当前文件所代表的规则名称
 *
 * @const
 * @type {string}
 */
var RULENAME = 'outline-none';

/**
 * 错误信息
 *
 * @const
 * @type {string}
 */
/**
 * @file outline-none 的检测逻辑
 *       Use of outline: none or outline: 0 should be limited to :focus rules
 *       https://github.com/CSSLint/csslint/wiki/Disallow-outline:none
 * @author ielgnaw(wuji0223@gmail.com)
 */

var MSG1 = 'Outlines should only be modified using :focus';

/**
 * 错误信息
 *
 * @const
 * @type {string}
 */
var MSG2 = 'Outlines shouldn\'t be hidden unless other visual changes are made';

var lastRule = void 0;

/**
 * 具体的检测逻辑
 *
 * @param {Object} opts 参数
 * @param {*} opts.ruleVal 当前规则具体配置的值
 * @param {string} opts.fileContent 文件内容
 * @param {string} opts.filePath 文件路径
 */
var check = exports.check = _postcss2.default.plugin(RULENAME, function (opts) {
    return function (css, result) {

        if (!opts.ruleVal) {
            return;
        }

        css.walkRules(function (rule) {
            if (global.CSSHINT_INVALID_ALL_COUNT >= opts.maxError) {
                return;
            }

            var selector = rule.selector;
            if (selector) {
                lastRule = {
                    rule: rule,
                    selector: selector,
                    propCount: 0,
                    outline: false
                };
            } else {
                lastRule = null;
            }

            rule.walkDecls(function (decl) {
                var prop = decl.prop,
                    value = decl.value;

                if (lastRule) {
                    lastRule.propCount++;
                    if (prop === 'outline' && (value === 'none' || value.toString() === '0')) {
                        lastRule.outline = true;
                    }
                }
            });

            if (lastRule) {
                if (lastRule.outline) {
                    var source = lastRule.rule.source;
                    var line = source.start.line;
                    var col = source.start.column;
                    var lineContent = (0, _util.getLineContent)(line, source.input.css);
                    if (lastRule.selector.toLowerCase().indexOf(':focus') === -1) {
                        result.warn(RULENAME, {
                            node: lastRule.rule,
                            ruleName: RULENAME,
                            line: line,
                            col: col,
                            message: MSG1,
                            colorMessage: '`' + lineContent.replace(selector, _chalk2.default.magenta(selector)) + '` ' + _chalk2.default.grey(MSG1)
                        });

                        global.CSSHINT_INVALID_ALL_COUNT++;
                    } else if (lastRule.propCount === 1) {
                        result.warn(RULENAME, {
                            node: lastRule.rule,
                            ruleName: RULENAME,
                            line: line,
                            col: col,
                            message: MSG2,
                            colorMessage: '`' + lineContent.replace(selector, _chalk2.default.magenta(selector)) + '` ' + _chalk2.default.grey(MSG2)
                        });

                        global.CSSHINT_INVALID_ALL_COUNT++;
                    }
                }
            }
        });
    };
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ydWxlL291dGxpbmUtbm9uZS5qcyJdLCJuYW1lcyI6WyJSVUxFTkFNRSIsIk1TRzEiLCJNU0cyIiwibGFzdFJ1bGUiLCJjaGVjayIsInBvc3Rjc3MiLCJwbHVnaW4iLCJjc3MiLCJyZXN1bHQiLCJvcHRzIiwicnVsZVZhbCIsIndhbGtSdWxlcyIsImdsb2JhbCIsIkNTU0hJTlRfSU5WQUxJRF9BTExfQ09VTlQiLCJtYXhFcnJvciIsInNlbGVjdG9yIiwicnVsZSIsInByb3BDb3VudCIsIm91dGxpbmUiLCJ3YWxrRGVjbHMiLCJwcm9wIiwiZGVjbCIsInZhbHVlIiwidG9TdHJpbmciLCJzb3VyY2UiLCJsaW5lIiwic3RhcnQiLCJjb2wiLCJjb2x1bW4iLCJsaW5lQ29udGVudCIsImlucHV0IiwidG9Mb3dlckNhc2UiLCJpbmRleE9mIiwid2FybiIsIm5vZGUiLCJydWxlTmFtZSIsIm1lc3NhZ2UiLCJjb2xvck1lc3NhZ2UiLCJyZXBsYWNlIiwiY2hhbGsiLCJtYWdlbnRhIiwiZ3JleSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQU9BOzs7O0FBQ0E7Ozs7QUFFQTs7OztBQUVBOzs7Ozs7QUFNQSxJQUFNQSxXQUFXLGNBQWpCOztBQUVBOzs7Ozs7QUFwQkE7Ozs7Ozs7QUEwQkEsSUFBTUMsT0FBTywrQ0FBYjs7QUFFQTs7Ozs7O0FBTUEsSUFBTUMsT0FBTyxvRUFBYjs7QUFFQSxJQUFJQyxpQkFBSjs7QUFFQTs7Ozs7Ozs7QUFRTyxJQUFNQyx3QkFBUUMsa0JBQVFDLE1BQVIsQ0FBZU4sUUFBZixFQUF5QjtBQUFBLFdBQzFDLFVBQUNPLEdBQUQsRUFBTUMsTUFBTixFQUFpQjs7QUFFYixZQUFJLENBQUNDLEtBQUtDLE9BQVYsRUFBbUI7QUFDZjtBQUNIOztBQUVESCxZQUFJSSxTQUFKLENBQWMsZ0JBQVE7QUFDbEIsZ0JBQUlDLE9BQU9DLHlCQUFQLElBQW9DSixLQUFLSyxRQUE3QyxFQUF1RDtBQUNuRDtBQUNIOztBQUVELGdCQUFNQyxXQUFXQyxLQUFLRCxRQUF0QjtBQUNBLGdCQUFJQSxRQUFKLEVBQWM7QUFDVlosMkJBQVc7QUFDUGEsMEJBQU1BLElBREM7QUFFUEQsOEJBQVVBLFFBRkg7QUFHUEUsK0JBQVcsQ0FISjtBQUlQQyw2QkFBUztBQUpGLGlCQUFYO0FBTUgsYUFQRCxNQVFLO0FBQ0RmLDJCQUFXLElBQVg7QUFDSDs7QUFFRGEsaUJBQUtHLFNBQUwsQ0FBZSxnQkFBUTtBQUFBLG9CQUNaQyxJQURZLEdBQ0dDLElBREgsQ0FDWkQsSUFEWTtBQUFBLG9CQUNORSxLQURNLEdBQ0dELElBREgsQ0FDTkMsS0FETTs7QUFFbkIsb0JBQUluQixRQUFKLEVBQWM7QUFDVkEsNkJBQVNjLFNBQVQ7QUFDQSx3QkFBSUcsU0FBUyxTQUFULEtBQXVCRSxVQUFVLE1BQVYsSUFBb0JBLE1BQU1DLFFBQU4sT0FBcUIsR0FBaEUsQ0FBSixFQUEwRTtBQUN0RXBCLGlDQUFTZSxPQUFULEdBQW1CLElBQW5CO0FBQ0g7QUFDSjtBQUNKLGFBUkQ7O0FBVUEsZ0JBQUlmLFFBQUosRUFBYztBQUNWLG9CQUFJQSxTQUFTZSxPQUFiLEVBQXNCO0FBQ2xCLHdCQUFNTSxTQUFTckIsU0FBU2EsSUFBVCxDQUFjUSxNQUE3QjtBQUNBLHdCQUFNQyxPQUFPRCxPQUFPRSxLQUFQLENBQWFELElBQTFCO0FBQ0Esd0JBQU1FLE1BQU1ILE9BQU9FLEtBQVAsQ0FBYUUsTUFBekI7QUFDQSx3QkFBTUMsY0FBYywwQkFBZUosSUFBZixFQUFxQkQsT0FBT00sS0FBUCxDQUFhdkIsR0FBbEMsQ0FBcEI7QUFDQSx3QkFBSUosU0FBU1ksUUFBVCxDQUFrQmdCLFdBQWxCLEdBQWdDQyxPQUFoQyxDQUF3QyxRQUF4QyxNQUFzRCxDQUFDLENBQTNELEVBQThEO0FBQzFEeEIsK0JBQU95QixJQUFQLENBQVlqQyxRQUFaLEVBQXNCO0FBQ2xCa0Msa0NBQU0vQixTQUFTYSxJQURHO0FBRWxCbUIsc0NBQVVuQyxRQUZRO0FBR2xCeUIsa0NBQU1BLElBSFk7QUFJbEJFLGlDQUFLQSxHQUphO0FBS2xCUyxxQ0FBU25DLElBTFM7QUFNbEJvQywwQ0FBYyxNQUNSUixZQUFZUyxPQUFaLENBQW9CdkIsUUFBcEIsRUFBOEJ3QixnQkFBTUMsT0FBTixDQUFjekIsUUFBZCxDQUE5QixDQURRLEdBRVIsSUFGUSxHQUdSd0IsZ0JBQU1FLElBQU4sQ0FBV3hDLElBQVg7QUFUWSx5QkFBdEI7O0FBWUFXLCtCQUFPQyx5QkFBUDtBQUNILHFCQWRELE1BZUssSUFBSVYsU0FBU2MsU0FBVCxLQUF1QixDQUEzQixFQUE4QjtBQUMvQlQsK0JBQU95QixJQUFQLENBQVlqQyxRQUFaLEVBQXNCO0FBQ2xCa0Msa0NBQU0vQixTQUFTYSxJQURHO0FBRWxCbUIsc0NBQVVuQyxRQUZRO0FBR2xCeUIsa0NBQU1BLElBSFk7QUFJbEJFLGlDQUFLQSxHQUphO0FBS2xCUyxxQ0FBU2xDLElBTFM7QUFNbEJtQywwQ0FBYyxNQUNSUixZQUFZUyxPQUFaLENBQW9CdkIsUUFBcEIsRUFBOEJ3QixnQkFBTUMsT0FBTixDQUFjekIsUUFBZCxDQUE5QixDQURRLEdBRVIsSUFGUSxHQUdSd0IsZ0JBQU1FLElBQU4sQ0FBV3ZDLElBQVg7QUFUWSx5QkFBdEI7O0FBWUFVLCtCQUFPQyx5QkFBUDtBQUNIO0FBQ0o7QUFDSjtBQUNKLFNBbEVEO0FBbUVILEtBMUV5QztBQUFBLENBQXpCLENBQWQiLCJmaWxlIjoib3V0bGluZS1ub25lLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBvdXRsaW5lLW5vbmUg55qE5qOA5rWL6YC76L6RXG4gKiAgICAgICBVc2Ugb2Ygb3V0bGluZTogbm9uZSBvciBvdXRsaW5lOiAwIHNob3VsZCBiZSBsaW1pdGVkIHRvIDpmb2N1cyBydWxlc1xuICogICAgICAgaHR0cHM6Ly9naXRodWIuY29tL0NTU0xpbnQvY3NzbGludC93aWtpL0Rpc2FsbG93LW91dGxpbmU6bm9uZVxuICogQGF1dGhvciBpZWxnbmF3KHd1amkwMjIzQGdtYWlsLmNvbSlcbiAqL1xuXG5pbXBvcnQgY2hhbGsgZnJvbSAnY2hhbGsnO1xuaW1wb3J0IHBvc3Rjc3MgZnJvbSAncG9zdGNzcyc7XG5cbmltcG9ydCB7Z2V0TGluZUNvbnRlbnR9IGZyb20gJy4uL3V0aWwnO1xuXG4vKipcbiAqIOW9k+WJjeaWh+S7tuaJgOS7o+ihqOeahOinhOWImeWQjeensFxuICpcbiAqIEBjb25zdFxuICogQHR5cGUge3N0cmluZ31cbiAqL1xuY29uc3QgUlVMRU5BTUUgPSAnb3V0bGluZS1ub25lJztcblxuLyoqXG4gKiDplJnor6/kv6Hmga9cbiAqXG4gKiBAY29uc3RcbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmNvbnN0IE1TRzEgPSAnT3V0bGluZXMgc2hvdWxkIG9ubHkgYmUgbW9kaWZpZWQgdXNpbmcgOmZvY3VzJztcblxuLyoqXG4gKiDplJnor6/kv6Hmga9cbiAqXG4gKiBAY29uc3RcbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmNvbnN0IE1TRzIgPSAnT3V0bGluZXMgc2hvdWxkblxcJ3QgYmUgaGlkZGVuIHVubGVzcyBvdGhlciB2aXN1YWwgY2hhbmdlcyBhcmUgbWFkZSc7XG5cbmxldCBsYXN0UnVsZTtcblxuLyoqXG4gKiDlhbfkvZPnmoTmo4DmtYvpgLvovpFcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyDlj4LmlbBcbiAqIEBwYXJhbSB7Kn0gb3B0cy5ydWxlVmFsIOW9k+WJjeinhOWImeWFt+S9k+mFjee9rueahOWAvFxuICogQHBhcmFtIHtzdHJpbmd9IG9wdHMuZmlsZUNvbnRlbnQg5paH5Lu25YaF5a65XG4gKiBAcGFyYW0ge3N0cmluZ30gb3B0cy5maWxlUGF0aCDmlofku7bot6/lvoRcbiAqL1xuZXhwb3J0IGNvbnN0IGNoZWNrID0gcG9zdGNzcy5wbHVnaW4oUlVMRU5BTUUsIG9wdHMgPT5cbiAgICAoY3NzLCByZXN1bHQpID0+IHtcblxuICAgICAgICBpZiAoIW9wdHMucnVsZVZhbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY3NzLndhbGtSdWxlcyhydWxlID0+IHtcbiAgICAgICAgICAgIGlmIChnbG9iYWwuQ1NTSElOVF9JTlZBTElEX0FMTF9DT1VOVCA+PSBvcHRzLm1heEVycm9yKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RvciA9IHJ1bGUuc2VsZWN0b3I7XG4gICAgICAgICAgICBpZiAoc2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgICBsYXN0UnVsZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgcnVsZTogcnVsZSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3I6IHNlbGVjdG9yLFxuICAgICAgICAgICAgICAgICAgICBwcm9wQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIG91dGxpbmU6IGZhbHNlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxhc3RSdWxlID0gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcnVsZS53YWxrRGVjbHMoZGVjbCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qge3Byb3AsIHZhbHVlfSA9IGRlY2w7XG4gICAgICAgICAgICAgICAgaWYgKGxhc3RSdWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RSdWxlLnByb3BDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcCA9PT0gJ291dGxpbmUnICYmICh2YWx1ZSA9PT0gJ25vbmUnIHx8IHZhbHVlLnRvU3RyaW5nKCkgPT09ICcwJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RSdWxlLm91dGxpbmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChsYXN0UnVsZSkge1xuICAgICAgICAgICAgICAgIGlmIChsYXN0UnVsZS5vdXRsaW5lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZSA9IGxhc3RSdWxlLnJ1bGUuc291cmNlO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5lID0gc291cmNlLnN0YXJ0LmxpbmU7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbCA9IHNvdXJjZS5zdGFydC5jb2x1bW47XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpbmVDb250ZW50ID0gZ2V0TGluZUNvbnRlbnQobGluZSwgc291cmNlLmlucHV0LmNzcyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsYXN0UnVsZS5zZWxlY3Rvci50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJzpmb2N1cycpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lndhcm4oUlVMRU5BTUUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlOiBsYXN0UnVsZS5ydWxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGVOYW1lOiBSVUxFTkFNRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBsaW5lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogY29sLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IE1TRzEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JNZXNzYWdlOiAnYCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBsaW5lQ29udGVudC5yZXBsYWNlKHNlbGVjdG9yLCBjaGFsay5tYWdlbnRhKHNlbGVjdG9yKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnYCAnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgY2hhbGsuZ3JleShNU0cxKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbC5DU1NISU5UX0lOVkFMSURfQUxMX0NPVU5UKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobGFzdFJ1bGUucHJvcENvdW50ID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQud2FybihSVUxFTkFNRSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGU6IGxhc3RSdWxlLnJ1bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZU5hbWU6IFJVTEVOQU1FLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IGxpbmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBjb2wsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogTVNHMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvck1lc3NhZ2U6ICdgJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGxpbmVDb250ZW50LnJlcGxhY2Uoc2VsZWN0b3IsIGNoYWxrLm1hZ2VudGEoc2VsZWN0b3IpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICdgICdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBjaGFsay5ncmV5KE1TRzIpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLkNTU0hJTlRfSU5WQUxJRF9BTExfQ09VTlQrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuKTtcbiJdfQ==