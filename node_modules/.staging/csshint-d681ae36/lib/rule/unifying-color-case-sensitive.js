'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.check = undefined;

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _util = require('../util');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 当前文件所代表的规则名称
 *
 * @const
 * @type {string}
 */
var RULENAME = 'unifying-color-case-sensitive';

/**
 * 错误的信息
 *
 * @const
 * @type {string}
 */
/**
 * @file unifying-color-case-sensitive 的检测逻辑
 *       032: [建议] 颜色值中的英文字符采用小写。如不用小写也需要保证同一项目内保持大小写一致。
 * @author ielgnaw(wuji0223@gmail.com)
 */

var MSG = '' + 'The color value of the small English character. ' + 'If no lower case also need to ensure that the same project to keep the same case';

/**
 * 具体的检测逻辑
 *
 * @param {Object} opts 参数
 * @param {*} opts.ruleVal 当前规则具体配置的值
 * @param {string} opts.fileContent 文件内容
 * @param {string} opts.filePath 文件路径
 */
var check = exports.check = _postcss2.default.plugin(RULENAME, function (opts) {
    return function (css, result) {

        if (opts.ruleVal) {

            var source = void 0;
            var line = void 0;
            var lineContent = void 0;
            var col = void 0;

            css.walkDecls(function (decl) {
                /* jshint maxstatements: 42, maxcomplexity: 12 */
                if (global.CSSHINT_INVALID_ALL_COUNT >= opts.maxError) {
                    return;
                }

                var value = decl.value;

                if (!/#([a-fA-Z0-9]{3,6})/.test(value) // 排除非 hexColor
                || /^#([0-9]{6})/.test(value) // 排除 #000000 纯数字的情况
                ) {
                        return;
                    }

                var simpleColorStr = RegExp.$1;

                // 当前这个颜色值里的字母全是小写 #fafafa
                if (/^([a-z0-9]{3,6})$/.test(simpleColorStr)) {
                    if (global.CSSHINT_HEXCOLOR_CASE_FLAG === undefined) {
                        global.CSSHINT_HEXCOLOR_CASE_FLAG = 0;
                    }

                    // 说明之前已经检测过的颜色值里面的字母应该是大写
                    if (global.CSSHINT_HEXCOLOR_CASE_FLAG === 1) {
                        source = decl.source;
                        line = source.start.line;
                        lineContent = (0, _util.getLineContent)(line, source.input.css);
                        col = source.start.column + decl.prop.length + decl.raws.between.length;
                        var upperCaseMsg = MSG + ', Current project case is UpperCase.';
                        var upperCaseColorMsg = MSG + ', Current project case is ' + _chalk2.default.magenta('UpperCase.');

                        result.warn(RULENAME, {
                            node: decl,
                            ruleName: RULENAME,
                            line: line,
                            col: col,
                            message: upperCaseMsg,
                            colorMessage: '`' + (0, _util.changeColorByStartAndEndIndex)(lineContent, col, source.end.column) + '` ' + _chalk2.default.grey(upperCaseColorMsg)
                        });

                        global.CSSHINT_INVALID_ALL_COUNT++;
                    }
                }
                // 当前这个颜色值里面的字母全是大写 #FAFAFA
                else if (/^([A-Z0-9]{3,6})$/.test(simpleColorStr)) {
                        if (global.CSSHINT_HEXCOLOR_CASE_FLAG === undefined) {
                            global.CSSHINT_HEXCOLOR_CASE_FLAG = 1;
                        }
                        // 说明之前已经检测过的颜色值里面的字母应该是大写
                        if (global.CSSHINT_HEXCOLOR_CASE_FLAG === 0) {
                            source = decl.source;
                            line = source.start.line;
                            lineContent = (0, _util.getLineContent)(line, source.input.css);
                            col = source.start.column + decl.prop.length + decl.raws.between.length;
                            var lowerCaseMsg = MSG + ', Current project case is LowerCase.';
                            var lowerCaseColorMsg = MSG + ', Current project case is ' + _chalk2.default.magenta('LowerCase.');

                            result.warn(RULENAME, {
                                node: decl,
                                ruleName: RULENAME,
                                line: line,
                                col: col,
                                message: lowerCaseMsg,
                                colorMessage: '`' + (0, _util.changeColorByStartAndEndIndex)(lineContent, col, source.end.column) + '` ' + _chalk2.default.grey(lowerCaseColorMsg)
                            });

                            global.CSSHINT_INVALID_ALL_COUNT++;
                        }
                    }
                    // 当前这个颜色值里面的字母有大写也有小写 #faFafA
                    else {
                            var str = MSG;
                            var colorStr = MSG;
                            if (global.CSSHINT_HEXCOLOR_CASE_FLAG === 0) {
                                str += ', Current project case is LowerCase.';
                                colorStr += ', Current project case is ' + _chalk2.default.magenta('LowerCase.');
                            } else if (global.CSSHINT_HEXCOLOR_CASE_FLAG === 1) {
                                str += ', Current project case is UpperCase.';
                                colorStr += ', Current project case is ' + _chalk2.default.magenta('UpperCase.');
                            }
                            source = decl.source;
                            line = source.start.line;
                            lineContent = (0, _util.getLineContent)(line, source.input.css);
                            col = source.start.column + decl.prop.length + decl.raws.between.length;

                            result.warn(RULENAME, {
                                node: decl,
                                ruleName: RULENAME,
                                line: line,
                                col: col,
                                message: str,
                                colorMessage: '`' + (0, _util.changeColorByStartAndEndIndex)(lineContent, col, source.end.column) + '` ' + _chalk2.default.grey(colorStr)
                            });

                            global.CSSHINT_INVALID_ALL_COUNT++;
                        }
            });
        }
    };
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ydWxlL3VuaWZ5aW5nLWNvbG9yLWNhc2Utc2Vuc2l0aXZlLmpzIl0sIm5hbWVzIjpbIlJVTEVOQU1FIiwiTVNHIiwiY2hlY2siLCJwb3N0Y3NzIiwicGx1Z2luIiwiY3NzIiwicmVzdWx0Iiwib3B0cyIsInJ1bGVWYWwiLCJzb3VyY2UiLCJsaW5lIiwibGluZUNvbnRlbnQiLCJjb2wiLCJ3YWxrRGVjbHMiLCJnbG9iYWwiLCJDU1NISU5UX0lOVkFMSURfQUxMX0NPVU5UIiwibWF4RXJyb3IiLCJ2YWx1ZSIsImRlY2wiLCJ0ZXN0Iiwic2ltcGxlQ29sb3JTdHIiLCJSZWdFeHAiLCIkMSIsIkNTU0hJTlRfSEVYQ09MT1JfQ0FTRV9GTEFHIiwidW5kZWZpbmVkIiwic3RhcnQiLCJpbnB1dCIsImNvbHVtbiIsInByb3AiLCJsZW5ndGgiLCJyYXdzIiwiYmV0d2VlbiIsInVwcGVyQ2FzZU1zZyIsInVwcGVyQ2FzZUNvbG9yTXNnIiwiY2hhbGsiLCJtYWdlbnRhIiwid2FybiIsIm5vZGUiLCJydWxlTmFtZSIsIm1lc3NhZ2UiLCJjb2xvck1lc3NhZ2UiLCJlbmQiLCJncmV5IiwibG93ZXJDYXNlTXNnIiwibG93ZXJDYXNlQ29sb3JNc2ciLCJzdHIiLCJjb2xvclN0ciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQU1BOzs7O0FBQ0E7Ozs7QUFFQTs7OztBQUVBOzs7Ozs7QUFNQSxJQUFNQSxXQUFXLCtCQUFqQjs7QUFFQTs7Ozs7O0FBbkJBOzs7Ozs7QUF5QkEsSUFBTUMsTUFBTSxLQUNOLGtEQURNLEdBRU4sa0ZBRk47O0FBSUE7Ozs7Ozs7O0FBUU8sSUFBTUMsd0JBQVFDLGtCQUFRQyxNQUFSLENBQWVKLFFBQWYsRUFBeUI7QUFBQSxXQUMxQyxVQUFDSyxHQUFELEVBQU1DLE1BQU4sRUFBaUI7O0FBRWIsWUFBSUMsS0FBS0MsT0FBVCxFQUFrQjs7QUFFZCxnQkFBSUMsZUFBSjtBQUNBLGdCQUFJQyxhQUFKO0FBQ0EsZ0JBQUlDLG9CQUFKO0FBQ0Es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LGdCQUFNUSxJQUFOLENBQVdJLFFBQVg7QUFYWSw2QkFBdEI7O0FBY0FoQyxtQ0FBT0MseUJBQVA7QUFDSDtBQUNKLGFBaEhEO0FBaUhIO0FBQ0osS0E1SHlDO0FBQUEsQ0FBekIsQ0FBZCIsImZpbGUiOiJ1bmlmeWluZy1jb2xvci1jYXNlLXNlbnNpdGl2ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgdW5pZnlpbmctY29sb3ItY2FzZS1zZW5zaXRpdmUg55qE5qOA5rWL6YC76L6RXG4gKiAgICAgICAwMzI6IFvlu7rorq5dIOminOiJsuWAvOS4reeahOiLseaWh+Wtl+espumHh+eUqOWwj+WGmeOAguWmguS4jeeUqOWwj+WGmeS5n+mcgOimgeS/neivgeWQjOS4gOmhueebruWGheS/neaMgeWkp+Wwj+WGmeS4gOiHtOOAglxuICogQGF1dGhvciBpZWxnbmF3KHd1amkwMjIzQGdtYWlsLmNvbSlcbiAqL1xuXG5pbXBvcnQgY2hhbGsgZnJvbSAnY2hhbGsnO1xuaW1wb3J0IHBvc3Rjc3MgZnJvbSAncG9zdGNzcyc7XG5cbmltcG9ydCB7Z2V0TGluZUNvbnRlbnQsIGNoYW5nZUNvbG9yQnlTdGFydEFuZEVuZEluZGV4fSBmcm9tICcuLi91dGlsJztcblxuLyoqXG4gKiDlvZPliY3mlofku7bmiYDku6PooajnmoTop4TliJnlkI3np7BcbiAqXG4gKiBAY29uc3RcbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmNvbnN0IFJVTEVOQU1FID0gJ3VuaWZ5aW5nLWNvbG9yLWNhc2Utc2Vuc2l0aXZlJztcblxuLyoqXG4gKiDplJnor6/nmoTkv6Hmga9cbiAqXG4gKiBAY29uc3RcbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmNvbnN0IE1TRyA9ICcnXG4gICAgKyAnVGhlIGNvbG9yIHZhbHVlIG9mIHRoZSBzbWFsbCBFbmdsaXNoIGNoYXJhY3Rlci4gJ1xuICAgICsgJ0lmIG5vIGxvd2VyIGNhc2UgYWxzbyBuZWVkIHRvIGVuc3VyZSB0aGF0IHRoZSBzYW1lIHByb2plY3QgdG8ga2VlcCB0aGUgc2FtZSBjYXNlJztcblxuLyoqXG4gKiDlhbfkvZPnmoTmo4DmtYvpgLvovpFcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyDlj4LmlbBcbiAqIEBwYXJhbSB7Kn0gb3B0cy5ydWxlVmFsIOW9k+WJjeinhOWImeWFt+S9k+mFjee9rueahOWAvFxuICogQHBhcmFtIHtzdHJpbmd9IG9wdHMuZmlsZUNvbnRlbnQg5paH5Lu25YaF5a65XG4gKiBAcGFyYW0ge3N0cmluZ30gb3B0cy5maWxlUGF0aCDmlofku7bot6/lvoRcbiAqL1xuZXhwb3J0IGNvbnN0IGNoZWNrID0gcG9zdGNzcy5wbHVnaW4oUlVMRU5BTUUsIG9wdHMgPT5cbiAgICAoY3NzLCByZXN1bHQpID0+IHtcblxuICAgICAgICBpZiAob3B0cy5ydWxlVmFsKSB7XG5cbiAgICAgICAgICAgIGxldCBzb3VyY2U7XG4gICAgICAgICAgICBsZXQgbGluZTtcbiAgICAgICAgICAgIGxldCBsaW5lQ29udGVudDtcbiAgICAgICAgICAgIGxldCBjb2w7XG5cbiAgICAgICAgICAgIGNzcy53YWxrRGVjbHMoZGVjbCA9PiB7XG4gICAgICAgICAgICAgICAgLyoganNoaW50IG1heHN0YXRlbWVudHM6IDQyLCBtYXhjb21wbGV4aXR5OiAxMiAqL1xuICAgICAgICAgICAgICAgIGlmIChnbG9iYWwuQ1NTSElOVF9JTlZBTElEX0FMTF9DT1VOVCA+PSBvcHRzLm1heEVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGRlY2wudmFsdWU7XG5cbiAgICAgICAgICAgICAgICBpZiAoIS8jKFthLWZBLVowLTldezMsNn0pLy50ZXN0KHZhbHVlKSAvLyDmjpLpmaTpnZ4gaGV4Q29sb3JcbiAgICAgICAgICAgICAgICAgICAgfHwgL14jKFswLTldezZ9KS8udGVzdCh2YWx1ZSkgLy8g5o6S6ZmkICMwMDAwMDAg57qv5pWw5a2X55qE5oOF5Ya1XG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzaW1wbGVDb2xvclN0ciA9IFJlZ0V4cC4kMTtcblxuICAgICAgICAgICAgICAgIC8vIOW9k+WJjei/meS4quminOiJsuWAvOmHjOeahOWtl+avjeWFqOaYr+Wwj+WGmSAjZmFmYWZhXG4gICAgICAgICAgICAgICAgaWYgKC9eKFthLXowLTldezMsNn0pJC8udGVzdChzaW1wbGVDb2xvclN0cikpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdsb2JhbC5DU1NISU5UX0hFWENPTE9SX0NBU0VfRkxBRyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwuQ1NTSElOVF9IRVhDT0xPUl9DQVNFX0ZMQUcgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8g6K+05piO5LmL5YmN5bey57uP5qOA5rWL6L+H55qE6aKc6Imy5YC86YeM6Z2i55qE5a2X5q+N5bqU6K+l5piv5aSn5YaZXG4gICAgICAgICAgICAgICAgICAgIGlmIChnbG9iYWwuQ1NTSElOVF9IRVhDT0xPUl9DQVNFX0ZMQUcgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZSA9IGRlY2wuc291cmNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IHNvdXJjZS5zdGFydC5saW5lO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluZUNvbnRlbnQgPSBnZXRMaW5lQ29udGVudChsaW5lLCBzb3VyY2UuaW5wdXQuY3NzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9IHNvdXJjZS5zdGFydC5jb2x1bW4gKyBkZWNsLnByb3AubGVuZ3RoICsgZGVjbC5yYXdzLmJldHdlZW4ubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBwZXJDYXNlTXNnID0gIE1TRyArICcsIEN1cnJlbnQgcHJvamVjdCBjYXNlIGlzIFVwcGVyQ2FzZS4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBwZXJDYXNlQ29sb3JNc2cgPSAgTVNHICsgJywgQ3VycmVudCBwcm9qZWN0IGNhc2UgaXMgJyArIGNoYWxrLm1hZ2VudGEoJ1VwcGVyQ2FzZS4nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lndhcm4oUlVMRU5BTUUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlOiBkZWNsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGVOYW1lOiBSVUxFTkFNRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBsaW5lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogY29sLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHVwcGVyQ2FzZU1zZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvck1lc3NhZ2U6ICdgJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGNoYW5nZUNvbG9yQnlTdGFydEFuZEVuZEluZGV4KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZUNvbnRlbnQsIGNvbCwgc291cmNlLmVuZC5jb2x1bW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICdgICdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBjaGFsay5ncmV5KHVwcGVyQ2FzZUNvbG9yTXNnKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbC5DU1NISU5UX0lOVkFMSURfQUxMX0NPVU5UKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8g5b2T5YmN6L+Z5Liq6aKc6Imy5YC86YeM6Z2i55qE5a2X5q+N5YWo5piv5aSn5YaZICNGQUZBRkFcbiAgICAgICAgICAgICAgICBlbHNlIGlmICgvXihbQS1aMC05XXszLDZ9KSQvLnRlc3Qoc2ltcGxlQ29sb3JTdHIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChnbG9iYWwuQ1NTSElOVF9IRVhDT0xPUl9DQVNFX0ZMQUcgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLkNTU0hJTlRfSEVYQ09MT1JfQ0FTRV9GTEFHID0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyDor7TmmI7kuYvliY3lt7Lnu4/mo4DmtYvov4fnmoTpopzoibLlgLzph4zpnaLnmoTlrZfmr43lupTor6XmmK/lpKflhplcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdsb2JhbC5DU1NISU5UX0hFWENPTE9SX0NBU0VfRkxBRyA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlID0gZGVjbC5zb3VyY2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gc291cmNlLnN0YXJ0LmxpbmU7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lQ29udGVudCA9IGdldExpbmVDb250ZW50KGxpbmUsIHNvdXJjZS5pbnB1dC5jc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sID0gc291cmNlLnN0YXJ0LmNvbHVtbiArIGRlY2wucHJvcC5sZW5ndGggKyBkZWNsLnJhd3MuYmV0d2Vlbi5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsb3dlckNhc2VNc2cgPSAgTVNHICsgJywgQ3VycmVudCBwcm9qZWN0IGNhc2UgaXMgTG93ZXJDYXNlLic7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsb3dlckNhc2VDb2xvck1zZyA9ICBNU0cgKyAnLCBDdXJyZW50IHByb2plY3QgY2FzZSBpcyAnICsgY2hhbGsubWFnZW50YSgnTG93ZXJDYXNlLicpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQud2FybihSVUxFTkFNRSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGU6IGRlY2wsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZU5hbWU6IFJVTEVOQU1FLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IGxpbmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBjb2wsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbG93ZXJDYXNlTXNnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yTWVzc2FnZTogJ2AnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgY2hhbmdlQ29sb3JCeVN0YXJ0QW5kRW5kSW5kZXgoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lQ29udGVudCwgY29sLCBzb3VyY2UuZW5kLmNvbHVtblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJ2AgJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGNoYWxrLmdyZXkobG93ZXJDYXNlQ29sb3JNc2cpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLkNTU0hJTlRfSU5WQUxJRF9BTExfQ09VTlQrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyDlvZPliY3ov5nkuKrpopzoibLlgLzph4zpnaLnmoTlrZfmr43mnInlpKflhpnkuZ/mnInlsI/lhpkgI2ZhRmFmQVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsZXQgc3RyID0gTVNHO1xuICAgICAgICAgICAgICAgICAgICBsZXQgY29sb3JTdHIgPSBNU0c7XG4gICAgICAgICAgICAgICAgICAgIGlmIChnbG9iYWwuQ1NTSElOVF9IRVhDT0xPUl9DQVNFX0ZMQUcgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ciArPSAnLCBDdXJyZW50IHByb2plY3QgY2FzZSBpcyBMb3dlckNhc2UuJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yU3RyICs9ICcsIEN1cnJlbnQgcHJvamVjdCBjYXNlIGlzICcgKyBjaGFsay5tYWdlbnRhKCdMb3dlckNhc2UuJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZ2xvYmFsLkNTU0hJTlRfSEVYQ09MT1JfQ0FTRV9GTEFHID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gJywgQ3VycmVudCBwcm9qZWN0IGNhc2UgaXMgVXBwZXJDYXNlLic7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvclN0ciArPSAnLCBDdXJyZW50IHByb2plY3QgY2FzZSBpcyAnICsgY2hhbGsubWFnZW50YSgnVXBwZXJDYXNlLicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZSA9IGRlY2wuc291cmNlO1xuICAgICAgICAgICAgICAgICAgICBsaW5lID0gc291cmNlLnN0YXJ0LmxpbmU7XG4gICAgICAgICAgICAgICAgICAgIGxpbmVDb250ZW50ID0gZ2V0TGluZUNvbnRlbnQobGluZSwgc291cmNlLmlucHV0LmNzcyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbCA9IHNvdXJjZS5zdGFydC5jb2x1bW4gKyBkZWNsLnByb3AubGVuZ3RoICsgZGVjbC5yYXdzLmJldHdlZW4ubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC53YXJuKFJVTEVOQU1FLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlOiBkZWNsLFxuICAgICAgICAgICAgICAgICAgICAgICAgcnVsZU5hbWU6IFJVTEVOQU1FLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbGluZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogY29sLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogc3RyLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JNZXNzYWdlOiAnYCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGNoYW5nZUNvbG9yQnlTdGFydEFuZEVuZEluZGV4KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lQ29udGVudCwgY29sLCBzb3VyY2UuZW5kLmNvbHVtblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICArICdgICdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGNoYWxrLmdyZXkoY29sb3JTdHIpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGdsb2JhbC5DU1NISU5UX0lOVkFMSURfQUxMX0NPVU5UKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4pO1xuIl19