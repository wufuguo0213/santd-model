'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.check = undefined;

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _util = require('../util');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 当前文件所代表的规则名称
 *
 * @const
 * @type {string}
 */
var RULENAME = 'unifying-font-family-case-sensitive';

/**
 * 错误的信息
 *
 * @const
 * @type {string}
 */
/**
 * @file unifying-font-family-case-sensitive 的检测逻辑
 *       036: [强制] `font-family` 不区分大小写，但在同一个项目中，同样的 `Family Name` 大小写必须统一。
 * @author ielgnaw(wuji0223@gmail.com)
 */

var MSG = '`font-family` case insensitive, but in the same project, the same` Family Name` case must be unified.';

/**
 * 获取错误信息
 *
 * @param {string} curFontFamily 当前检测的这个 font-family 值
 * @param {string} projFontFamily 项目级别对应的这个 font-family 值
 *
 * @return {Object} 错误信息
 */
var getMsg = function getMsg(curFontFamily, projFontFamily) {
    return {
        msg: MSG + ' In currently project, ' + '`' + curFontFamily + '` should be `' + projFontFamily + '`.',
        colorMsg: MSG + ' In currently project, ' + '`' + _chalk2.default.magenta(curFontFamily) + '` should be `' + _chalk2.default.magenta(projFontFamily) + '`.'
    };
};

/**
 * 具体的检测逻辑
 *
 * @param {Object} opts 参数
 * @param {*} opts.ruleVal 当前规则具体配置的值
 * @param {string} opts.fileContent 文件内容
 * @param {string} opts.filePath 文件路径
 */
var check = exports.check = _postcss2.default.plugin(RULENAME, function (opts) {
    return function (css, result) {
        if (!opts.ruleVal) {
            return;
        }

        css.walkDecls(function (decl) {
            if (global.CSSHINT_INVALID_ALL_COUNT >= opts.maxError) {
                return;
            }

            var prop = decl.prop;

            if (prop === 'font-family') {
                var parts = _postcss2.default.list.space(decl.value);
                for (var i = 0, len = parts.length; i < len; i++) {
                    var part = parts[i].replace(/['",]/g, '');
                    var partLowerCase = part.toLowerCase();

                    if (!global.CSSHINT_FONTFAMILY_CASE_FLAG[partLowerCase]) {
                        global.CSSHINT_FONTFAMILY_CASE_FLAG[partLowerCase] = part;
                    } else {
                        if (global.CSSHINT_FONTFAMILY_CASE_FLAG[partLowerCase] !== part) {
                            var source = decl.source;
                            var line = source.start.line;
                            var lineContent = (0, _util.getLineContent)(line, source.input.css);
                            var col = lineContent.indexOf(part) + 1;

                            var m = getMsg(part, global.CSSHINT_FONTFAMILY_CASE_FLAG[partLowerCase]);

                            result.warn(RULENAME, {
                                node: decl,
                                ruleName: RULENAME,
                                line: line,
                                col: col,
                                message: m.msg,
                                colorMessage: '`' + lineContent.replace(part, _chalk2.default.magenta(part)) + '` ' + _chalk2.default.grey(m.colorMsg)
                            });
                            global.CSSHINT_INVALID_ALL_COUNT++;
                        }
                    }
                }
            }
        });
    };
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ydWxlL3VuaWZ5aW5nLWZvbnQtZmFtaWx5LWNhc2Utc2Vuc2l0aXZlLmpzIl0sIm5hbWVzIjpbIlJVTEVOQU1FIiwiTVNHIiwiZ2V0TXNnIiwiY3VyRm9udEZhbWlseSIsInByb2pGb250RmFtaWx5IiwibXNnIiwiY29sb3JNc2ciLCJjaGFsayIsIm1hZ2VudGEiLCJjaGVjayIsInBvc3Rjc3MiLCJwbHVnaW4iLCJjc3MiLCJyZXN1bHQiLCJvcHRzIiwicnVsZVZhbCIsIndhbGtEZWNscyIsImdsb2JhbCIsIkNTU0hJTlRfSU5WQUxJRF9BTExfQ09VTlQiLCJtYXhFcnJvciIsInByb3AiLCJkZWNsIiwicGFydHMiLCJsaXN0Iiwic3BhY2UiLCJ2YWx1ZSIsImkiLCJsZW4iLCJsZW5ndGgiLCJwYXJ0IiwicmVwbGFjZSIsInBhcnRMb3dlckNhc2UiLCJ0b0xvd2VyQ2FzZSIsIkNTU0hJTlRfRk9OVEZBTUlMWV9DQVNFX0ZMQUciLCJzb3VyY2UiLCJsaW5lIiwic3RhcnQiLCJsaW5lQ29udGVudCIsImlucHV0IiwiY29sIiwiaW5kZXhPZiIsIm0iLCJ3YXJuIiwibm9kZSIsInJ1bGVOYW1lIiwibWVzc2FnZSIsImNvbG9yTWVzc2FnZSIsImdyZXkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFNQTs7OztBQUNBOzs7O0FBRUE7Ozs7QUFFQTs7Ozs7O0FBTUEsSUFBTUEsV0FBVyxxQ0FBakI7O0FBRUE7Ozs7OztBQW5CQTs7Ozs7O0FBeUJBLElBQU1DLE1BQU0sdUdBQVo7O0FBRUE7Ozs7Ozs7O0FBUUEsSUFBTUMsU0FBUyxTQUFUQSxNQUFTLENBQUNDLGFBQUQsRUFBZ0JDLGNBQWhCLEVBQW1DO0FBQzlDLFdBQU87QUFDSEMsYUFBS0osTUFDQyx5QkFERCxHQUVDLEdBRkQsR0FHQ0UsYUFIRCxHQUlDLGVBSkQsR0FLR0MsY0FMSCxHQU1DLElBUEg7QUFRSEUsa0JBQVVMLE1BQ0oseUJBREksR0FFSixHQUZJLEdBR0pNLGdCQUFNQyxPQUFOLENBQWNMLGFBQWQsQ0FISSxHQUlKLGVBSkksR0FLSkksZ0JBQU1DLE9BQU4sQ0FBY0osY0FBZCxDQUxJLEdBTUo7QUFkSCxLQUFQO0FBZ0JILENBakJEOztBQW1CQTs7Ozs7Ozs7QUFRTyxJQUFNSyx3QkFBUUMsa0JBQVFDLE1BQVIsQ0FBZVgsUUFBZixFQUF5QjtBQUFBLFdBQzFDLFVBQUNZLEdBQUQsRUFBTUMsTUFBTixFQUFpQjtBQUNiLFlBQUksQ0FBQ0MsS0FBS0MsT0FBVixFQUFtQjtBQUNmO0FBQ0g7O0FBRURILFlBQUlJLFNBQUosQ0FBYyxnQkFBUTtBQUNsQixnQkFBSUMsT0FBT0MseUJBQVAsSUFBb0NKLEtBQUtLLFFBQTdDLEVBQXVEO0FBQ25EO0FBQ0g7O0FBRUQsZ0JBQU1DLE9BQU9DLEtBQUtELElBQWxCOztBQUVBLGdCQUFJQSxTQUFTLGFBQWIsRUFBNEI7QUFDeEIsb0JBQU1FLFFBQVFaLGtCQUFRYSxJQUFSLENBQWFDLEtBQWIsQ0FBbUJILEtBQUtJLEtBQXhCLENBQWQ7QUFDQSxxQkFBSyxJQUFJQyxJQUFJLENBQVIsRUFBV0MsTUFBTUwsTUFBTU0sTUFBNUIsRUFBb0NGLElBQUlDLEdBQXhDLEVBQTZDRCxHQUE3QyxFQUFrRDtBQUM5Qyx3QkFBTUcsT0FBT1AsTUFBTUksQ0FBTixFQUFTSSxPQUFULENBQWlCLFFBQWpCLEVBQTJCLEVBQTNCLENBQWI7QUFDQSx3QkFBTUMsZ0JBQWdCRixLQUFLRyxXQUFMLEVBQXRCOztBQUVBLHdCQUFJLENBQUNmLE9BQU9nQiw0QkFBUCxDQUFvQ0YsYUFBcEMsQ0FBTCxFQUF5RDtBQUNyRGQsK0JBQU9nQiw0QkFBUCxDQUFvQ0YsYUFBcEMsSUFBcURGLElBQXJEO0FBQ0gscUJBRkQsTUFHSztBQUNELDRCQUFJWixPQUFPZ0IsNEJBQVAsQ0FBb0NGLGFBQXBDLE1BQXVERixJQUEzRCxFQUFpRTtBQUM3RCxnQ0FBTUssU0FBU2IsS0FBS2EsTUFBcEI7QUFDQSxnQ0FBTUMsT0FBT0QsT0FBT0UsS0FBUCxDQUFhRCxJQUExQjtBQUNBLGdDQUFNRSxjQUFjLDBCQUFlRixJQUFmLEVBQXFCRCxPQUFPSSxLQUFQLENBQWExQixHQUFsQyxDQUFwQjtBQUNBLGdDQUFNMkIsTUFBTUYsWUFBWUcsT0FBWixDQUFvQlgsSUFBcEIsSUFBNEIsQ0FBeEM7O0FBRUEsZ0NBQU1ZLElBQUl2QyxPQUFPMkIsSUFBUCxFQUFhWixPQUFPZ0IsNEJBQVAsQ0FBb0NGLGFBQXBDLENBQWIsQ0FBVjs7QUFFQWxCLG1DQUFPNkIsSUFBUCxDQUFZMUMsUUFBWixFQUFzQjtBQUNsQjJDLHNDQUFNdEIsSUFEWTtBQUVsQnVCLDBDQUFVNUMsUUFGUTtBQUdsQm1DLHNDQUFNQSxJQUhZO0FBSWxCSSxxQ0FBS0EsR0FKYTtBQUtsQk0seUNBQVNKLEVBQUVwQyxHQUxPO0FBTWxCeUMsOENBQWMsTUFDUlQsWUFBWVAsT0FBWixDQUFvQkQsSUFBcEIsRUFBMEJ0QixnQkFBTUMsT0FBTixDQUFjcUIsSUFBZCxDQUExQixDQURRLEdBRVIsSUFGUSxHQUdSdEIsZ0JBQU13QyxJQUFOLENBQVdOLEVBQUVuQyxRQUFiO0FBVFksNkJBQXRCO0FBV0FXLG1DQUFPQyx5QkFBUDtBQUNIO0FBQ0o7QUFDSjtBQUNKO0FBQ0osU0F6Q0Q7QUEwQ0gsS0FoRHlDO0FBQUEsQ0FBekIsQ0FBZCIsImZpbGUiOiJ1bmlmeWluZy1mb250LWZhbWlseS1jYXNlLXNlbnNpdGl2ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgdW5pZnlpbmctZm9udC1mYW1pbHktY2FzZS1zZW5zaXRpdmUg55qE5qOA5rWL6YC76L6RXG4gKiAgICAgICAwMzY6IFvlvLrliLZdIGBmb250LWZhbWlseWAg5LiN5Yy65YiG5aSn5bCP5YaZ77yM5L2G5Zyo5ZCM5LiA5Liq6aG555uu5Lit77yM5ZCM5qC355qEIGBGYW1pbHkgTmFtZWAg5aSn5bCP5YaZ5b+F6aG757uf5LiA44CCXG4gKiBAYXV0aG9yIGllbGduYXcod3VqaTAyMjNAZ21haWwuY29tKVxuICovXG5cbmltcG9ydCBjaGFsayBmcm9tICdjaGFsayc7XG5pbXBvcnQgcG9zdGNzcyBmcm9tICdwb3N0Y3NzJztcblxuaW1wb3J0IHtnZXRMaW5lQ29udGVudH0gZnJvbSAnLi4vdXRpbCc7XG5cbi8qKlxuICog5b2T5YmN5paH5Lu25omA5Luj6KGo55qE6KeE5YiZ5ZCN56ewXG4gKlxuICogQGNvbnN0XG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5jb25zdCBSVUxFTkFNRSA9ICd1bmlmeWluZy1mb250LWZhbWlseS1jYXNlLXNlbnNpdGl2ZSc7XG5cbi8qKlxuICog6ZSZ6K+v55qE5L+h5oGvXG4gKlxuICogQGNvbnN0XG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5jb25zdCBNU0cgPSAnYGZvbnQtZmFtaWx5YCBjYXNlIGluc2Vuc2l0aXZlLCBidXQgaW4gdGhlIHNhbWUgcHJvamVjdCwgdGhlIHNhbWVgIEZhbWlseSBOYW1lYCBjYXNlIG11c3QgYmUgdW5pZmllZC4nO1xuXG4vKipcbiAqIOiOt+WPlumUmeivr+S/oeaBr1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBjdXJGb250RmFtaWx5IOW9k+WJjeajgOa1i+eahOi/meS4qiBmb250LWZhbWlseSDlgLxcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9qRm9udEZhbWlseSDpobnnm67nuqfliKvlr7nlupTnmoTov5nkuKogZm9udC1mYW1pbHkg5YC8XG4gKlxuICogQHJldHVybiB7T2JqZWN0fSDplJnor6/kv6Hmga9cbiAqL1xuY29uc3QgZ2V0TXNnID0gKGN1ckZvbnRGYW1pbHksIHByb2pGb250RmFtaWx5KSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbXNnOiBNU0dcbiAgICAgICAgICAgICsgJyBJbiBjdXJyZW50bHkgcHJvamVjdCwgJ1xuICAgICAgICAgICAgKyAnYCdcbiAgICAgICAgICAgICsgY3VyRm9udEZhbWlseVxuICAgICAgICAgICAgKyAnYCBzaG91bGQgYmUgYCdcbiAgICAgICAgICAgICsgICBwcm9qRm9udEZhbWlseVxuICAgICAgICAgICAgKyAnYC4nLFxuICAgICAgICBjb2xvck1zZzogTVNHXG4gICAgICAgICAgICArICcgSW4gY3VycmVudGx5IHByb2plY3QsICdcbiAgICAgICAgICAgICsgJ2AnXG4gICAgICAgICAgICArIGNoYWxrLm1hZ2VudGEoY3VyRm9udEZhbWlseSlcbiAgICAgICAgICAgICsgJ2Agc2hvdWxkIGJlIGAnXG4gICAgICAgICAgICArIGNoYWxrLm1hZ2VudGEocHJvakZvbnRGYW1pbHkpXG4gICAgICAgICAgICArICdgLidcbiAgICB9O1xufTtcblxuLyoqXG4gKiDlhbfkvZPnmoTmo4DmtYvpgLvovpFcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyDlj4LmlbBcbiAqIEBwYXJhbSB7Kn0gb3B0cy5ydWxlVmFsIOW9k+WJjeinhOWImeWFt+S9k+mFjee9rueahOWAvFxuICogQHBhcmFtIHtzdHJpbmd9IG9wdHMuZmlsZUNvbnRlbnQg5paH5Lu25YaF5a65XG4gKiBAcGFyYW0ge3N0cmluZ30gb3B0cy5maWxlUGF0aCDmlofku7bot6/lvoRcbiAqL1xuZXhwb3J0IGNvbnN0IGNoZWNrID0gcG9zdGNzcy5wbHVnaW4oUlVMRU5BTUUsIG9wdHMgPT5cbiAgICAoY3NzLCByZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKCFvcHRzLnJ1bGVWYWwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNzcy53YWxrRGVjbHMoZGVjbCA9PiB7XG4gICAgICAgICAgICBpZiAoZ2xvYmFsLkNTU0hJTlRfSU5WQUxJRF9BTExfQ09VTlQgPj0gb3B0cy5tYXhFcnJvcikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgcHJvcCA9IGRlY2wucHJvcDtcblxuICAgICAgICAgICAgaWYgKHByb3AgPT09ICdmb250LWZhbWlseScpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IHBvc3Rjc3MubGlzdC5zcGFjZShkZWNsLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcGFydHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFydCA9IHBhcnRzW2ldLnJlcGxhY2UoL1snXCIsXS9nLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRMb3dlckNhc2UgPSBwYXJ0LnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFnbG9iYWwuQ1NTSElOVF9GT05URkFNSUxZX0NBU0VfRkxBR1twYXJ0TG93ZXJDYXNlXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLkNTU0hJTlRfRk9OVEZBTUlMWV9DQVNFX0ZMQUdbcGFydExvd2VyQ2FzZV0gPSBwYXJ0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdsb2JhbC5DU1NISU5UX0ZPTlRGQU1JTFlfQ0FTRV9GTEFHW3BhcnRMb3dlckNhc2VdICE9PSBwYXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlID0gZGVjbC5zb3VyY2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGluZSA9IHNvdXJjZS5zdGFydC5saW5lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpbmVDb250ZW50ID0gZ2V0TGluZUNvbnRlbnQobGluZSwgc291cmNlLmlucHV0LmNzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sID0gbGluZUNvbnRlbnQuaW5kZXhPZihwYXJ0KSArIDE7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gZ2V0TXNnKHBhcnQsIGdsb2JhbC5DU1NISU5UX0ZPTlRGQU1JTFlfQ0FTRV9GTEFHW3BhcnRMb3dlckNhc2VdKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC53YXJuKFJVTEVOQU1FLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGU6IGRlY2wsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGVOYW1lOiBSVUxFTkFNRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbGluZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBjb2wsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG0ubXNnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvck1lc3NhZ2U6ICdgJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBsaW5lQ29udGVudC5yZXBsYWNlKHBhcnQsIGNoYWxrLm1hZ2VudGEocGFydCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICdgICdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgY2hhbGsuZ3JleShtLmNvbG9yTXNnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbC5DU1NISU5UX0lOVkFMSURfQUxMX0NPVU5UKys7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbik7XG4iXX0=