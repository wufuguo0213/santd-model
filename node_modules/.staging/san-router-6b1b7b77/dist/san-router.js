!function(t){function e(t){switch(typeof t){case"object":return t;case"string":return document.querySelector?document.querySelector(t):document.getElementById(t.replace(/#/i,""))}}function r(t){var e={hash:"",queryString:"",params:{},query:{},path:t},r=e.path.indexOf("#");r>=0&&(e.hash=e.path.slice(r+1),e.path=e.path.slice(0,r));var n=e.query,i=e.path.indexOf("?");if(i>=0){e.queryString=e.path.slice(i+1),e.path=e.path.slice(0,i);for(var o=e.queryString.split("&"),s=0;s<o.length;s++){var a=o[s],h=a.indexOf("="),c="";h>0&&(c=a.slice(h+1),a=a.slice(0,h));var u=decodeURIComponent(a);c=decodeURIComponent(c),n.hasOwnProperty(u)?n[u]=[].concat(n[u],c):n[u]=c}}return e}function n(t){if(!t)return"";if("string"==typeof t)return t;var e,r=t.query,n=t.params,i=t.path||"",o=[];if(i)for(var s=i.split("/"),a=0,h=s.length;a<h;a++){var c=s[a];if(/^:[a-z0-9_-]+$/.test(c)){e=!0;var u=c.slice(1);o.push(n&&n[u]||r&&r[u])}else o.push(c)}var p=t.queryString||"";if(0===p.indexOf("?")&&(p=p.slice(1)),!p&&r&&(!e||n)){var f=!0;for(var l in r)r.hasOwnProperty(l)&&(p+=(f?"":"&")+l+"="+encodeURIComponent(r[l]),f=!1)}return o.join("/")+(p&&"?")+p}function i(t,e){var n=r(t),i=r(e),o=n.path;if(0===o.indexOf("/"))return t;var s;if(o){var a=o.split("/"),h=i.path.split("/");h.pop();for(var c=0;c<a.length;c++){var u=a[c];switch(u){case"..":h.pop();break;case".":break;default:h.push(u)}}""!==h[0]&&h.unshift(""),s=h.join("/")}else s=i.path;return s+(n.queryString?"?"+n.queryString:"")}function o(){}function s(){var t=location.href.indexOf("#");return t<0?"/":location.href.slice(t+1)||"/"}function a(){this.current=s(),this.referrer="";var t=this;this.hashChangeHandler=function(){t.redirect(s())}}function h(){return location.pathname+location.search}function c(){this.current=h(),this.referrer="";var t=this;this.popstateHandler=function(){t.referrer=t.current,t.current=h(),t.fire("redirect",{url:t.current,referrer:t.referrer})}}function u(){return(++d).toString()}function p(t){return t.prototype&&(5===t.prototype.nodeType||"san-cmpt"===t.prototype._type)}function f(t){return function(e){function n(){v>0&&(h<t.listeners.length?(t.listeners[h].call(t,y,a.config),v>0&&i()):o())}function i(){v=1,h++,n()}function o(){if(s)t.doRoute(s,a);else for(var e=t.routeAlives.length;e--;)t.routeAlives[e].component.dispose(),t.routeAlives.splice(e,1)}for(var s,a=r(e.url),h=0;h<t.routes.length;h++){var c=t.routes[h],u=c.rule.exec(a.path);if(u){s=c;for(var p=c.keys||[],f=1;f<u.length;f++){var l=p[f]||f,d=u[f];a.query[l]=d,a.params[l]=d}a.referrer=e.referrer,a.config=c.config;break}}var h=0,v=1,y={url:e.url,hash:a.hash,queryString:a.queryString,query:a.query,params:a.params,path:a.path,referrer:a.referrer,config:a.config,resume:i,suspend:function(){v=0},stop:function(){v=-1}};n()}}function l(t){t=t||{};var e=t.mode||"hash";if("html5"===e&&!c.isSupport)throw new Error("[SAN-ROUTER ERROR] Your navigator doesn't supports HTML5!");this.routes=[],this.routeAlives=[],this.listeners=[],this.locatorRedirectHandler=f(this),this.setMode(e)}o.prototype.on=function(t,e){"function"==typeof e&&(this._eventListeners||(this._eventListeners={}),this._eventListeners[t]||(this._eventListeners[t]=[]),this._eventListeners[t].push(e))},o.prototype.un=function(t,e){if(this._eventListeners&&this._eventListeners[t])if(e)for(var r=this._eventListeners[t],n=r.length;n--;)r[n]===e&&r.splice(n,1);else this._eventListeners[t]=[]},o.prototype.fire=function(t,e){if(!t)throw new Error("No event type specified");var r=this._eventListeners&&this._eventListeners[t];if(r)for(var n=0;n<r.length;n++)r[n](e)},a.prototype=new o,a.prototype.constructor=a,a.prototype.start=function(){window.addEventListener&&window.addEventListener("hashchange",this.hashChangeHandler,!1),window.attachEvent&&window.attachEvent("onhashchange",this.hashChangeHandler)},a.prototype.stop=function(){window.removeEventListener&&window.removeEventListener("hashchange",this.hashChangeHandler,!1),window.detachEvent&&window.detachEvent("onhashchange",this.hashChangeHandler)},a.prototype.redirect=function(t,e){e=e||{},t=i(t,this.current);var r=this.current,n=t!==r;n?(this.referrer=r,this.current=t,location.hash=t):r=this.referrer,!n&&!e.force||e.silent||this.fire("redirect",{url:t,referrer:r})},a.prototype.reload=function(){this.redirect(this.current,{force:!0})},c.prototype=new o,c.prototype.constructor=c,c.prototype.start=function(){window.addEventListener("popstate",this.popstateHandler)},c.prototype.stop=function(){window.removeEventListener("popstate",this.popstateHandler)},c.prototype.redirect=function(t,e){e=e||{},t=i(t,this.current);var r=this.current,n=t!==r;n&&(this.referrer=r,this.current=t,history.pushState({},"",t)),!n&&!e.force||e.silent||this.fire("redirect",{url:t,referrer:r})},c.prototype.reload=function(){this.fire("redirect",{url:this.current,referrer:this.referrer})},c.isSupport="pushState"in window.history;var d=365611;l.prototype.listen=function(t){this.listeners.push(t)},l.prototype.unlisten=function(t){for(var e=this.listeners.length;e--;)this.listeners[e]===t&&this.listeners.splice(e,1)},l.prototype.start=function(){return this.isStarted||(this.isStarted=!0,this.locator.on("redirect",this.locatorRedirectHandler),this.locator.start(),this.locator.reload()),this},l.prototype.stop=function(){return this.locator.un("redirect",this.locatorRedirectHandler),this.locator.stop(),this.isStarted=!1,this},l.prototype.setMode=function(t){if(t=t.toLowerCase(),this.mode!==t){this.mode=t;var e=!1;switch(this.isStarted&&(this.stop(),e=!0),t){case"hash":this.locator=new a;break;case"html5":this.locator=new c}return e&&this.start(),this}},l.prototype.doRoute=function(t,e){for(var r=!1,n=this.routeAlives.length;n--;){var i=this.routeAlives[n];i.id===t.id?(i.component.data.set("route",e),"function"==typeof i.component.route&&i.component.route(),r=!0):(i.component.dispose(),this.routeAlives.splice(n,1))}if(!r)if(t.Component)if(p(t.Component))this.attachCmpt(t,e);else{var o=this;t.Component().then(function(r){p(r)?t.Component=r:r.__esModule&&p(r.default)&&(t.Component=r.default),o.attachCmpt(t,e)})}else t.handler.call(this,e)},l.prototype.attachCmpt=function(t,r){var n=this,i=new t.Component;i.$router=this,i.data.set("route",r),"function"==typeof i.route&&i.route();var o=t.target,s=e(o);if(!s)throw new Error('[SAN-ROUTER ERROR] Attach failed, target element "'+t.target+'" is not found.');i.attach(s),this.routeAlives.push({component:i,id:t.id}),"function"==typeof t.handler&&setTimeout(function(){t.handler.call(n,r)})},l.prototype.add=function(t){var e=t.rule,r=[""];if("string"==typeof e){var n=e.replace(/\/:([a-z0-9_-]+)(?=\/|$)/gi,function(t,e){return r.push(e),"/([^/\\s]+)"});e=new RegExp("^"+n+"$","i")}if(!(e instanceof RegExp))throw new Error("[SAN-ROUTER ERROR] Rule must be string or RegExp!");var i=u();return this.routes.push({id:i,rule:e,handler:t.handler,keys:r,target:t.target||"#main",Component:t.Component,config:t}),this},l.prototype.push=function(t,e){(t=n(t))&&this.locator.redirect(t,e)};var v=new l,y={Link:{template:'<a href="{{hrefPrefix}}{{href}}" onclick="return false;" on-click="clicker($event)" target="{{target}}" class="{{isActive ? activeClass : \'\'}}"><slot/></a>',clicker:function(t){var e=this.data.get("href");"string"==typeof e&&v.locator.redirect(e.replace(/^#/,"")),t.preventDefault?t.preventDefault():t.returnValue=!1},inited:function(){var t=this;this.routeListener=function(e){t.data.set("isActive",e.url===t.data.get("href"))},this.routeListener({url:v.locator.current}),v.listen(this.routeListener)},disposed:function(){v.unlisten(this.routeListener),this.routeListener=null},initData:function(){return{isActive:!1,hrefPrefix:"hash"===v.mode?"#":""}},computed:{href:function(){return i(this.data.get("to")||"",v.locator.current)}}},router:v,Router:l,HashLocator:a,HTML5Locator:c,resolveURL:i,parseURL:r,stringifyURL:n,version:"1.2.4"};"object"==typeof exports&&"object"==typeof module?exports=module.exports=y:"function"==typeof define&&define.amd?define("san-router",[],y):t.sanRouter=y}(this);